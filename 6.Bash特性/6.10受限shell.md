## 6.10 受限shell

如果是使用的rbash启动的Bash，或在调用Bash时提供了“--restricted”或“-r”选项，则shell变为受限制的。受限的shell在设置环境时比标准shell具有更多的控制。除了下面列出的条目在受限shell中是不允许的或不会执行的，其它行为都与bash是一样的：

- 使用内建命令cd改变目录。
- 设置或释放变量SHELL、PATH、HISTFILE、ENV或BASH_ENV的值。
- 指定包含斜线的命令名。
- 指定包含斜线的文件名作为内建命令“.”的参数。
- 指定包含斜线的文件名作为内建命令“history”的参数。
- 指定包含斜线的文件名作为带有“-p”选项的内建命令“hash”的参数。
- 在启动时从shell环境导入函数定义。
- 在启动时从shell环境解析变量SHELLOPTS的值。
- 使用重定向操作符“>”、“>|”、“<>”、“>&”、“&>”和“>>”重定向输出。
- 使用内建命令exec来替换带有其它命令的shell。
- 使用带有“-f”和“-d”选项的内建命令enable来添加或删除内建命令。
- 对内建命令command指定“-p”选项。
- 使用“set +r”或“set +o restricted”来关闭受限模式。

在读取了任意启动文件之后，这些限制是强制的。

当发现执行的命令是一个shell脚本（参见3.8《shell脚本》）时，rbash会在生成的用于执行脚本的shell中关闭这些限制。

受限shell模式只是一个有用的受限环境的组件。其应该还有：允许执行很少一部分已验证的命令（能够让shell规避特定攻击的命令）而设置的PATH值；在登录后使用户处于一个不可写入的目录，而不是其家目录；不允许受限shell执行shell脚本；和清除一些变量环境，使一些命令不能改变它们的行为（例如，VISUAL或PAGER）。

现代系统提供更安全的方式来执行受限环境，例如“jails”、“zones”或“containers”。