## Bash内建命令

这一节所描述的内建命令是Bash独有的，或经过扩展的。有一些命令是定义在POSIX标准下面的。

### alias

```
alias [-p] [name[=value] ...]
```

如果alias命令不还有任何参数或使用了“-p”选项，则将别名列表表示为可用于再次输入的格式输出到标准输出中。如果提供了参数，则使用name做为别名，value做为其值对别名进行定义操作。如果没有给出value，则打印出该name的别名和值。关于别名的描述，请参考6.6节《别名》。

### bind

```
bind [-m keymap] [-lpsvPSVX]
bind [-m keymap] [-q function] [-u function] [-r keyseq]
bind [-m keymap] -f filename
bind [-m keymap] -x keyseq:shell-command
bind [-m keymap] keyseq:function-name
bind [-m keymap] keyseq:readline-command
```

显示当前读取行（Readline）的键和函数的绑定，或将读取行函数或宏与一个键序列绑定，或设置一个读取行变量。每一个非选项参数是一个命令，其会出现在读取行初始化文件中。但每一个绑定或命令必须作为一个分开的参数进行传递；例如，“"\C-x\C-r":re-read-init-file”。

如果下列选项出现，则具有如下意义：

选项 | 含义
--- | ---
-m keymap | 在后继绑定中使用keymap作为映射键。可接受的keymap名称有：emacs、emacs-standard、emacs-meta、emacs-ctlx、vi、vi-move、vi-command和vi-insert。vi等同于vi-command（vi-move也是一个意思）；emacs等同于emacs-standard。
-l | 列出所有读取行函数的名称。
-p | 显示为可用于输入或在读取行初始化文件中使用的读取行函数名称和绑定。
-P | 列出当前读取行函数名称和绑定。
-v | 显示为可用于输入或在读取行初始化文件中使用的读取行变量名称和绑定。
-V | 列出当前读取行变量名称和值。
-s | 显示输出为可用于输入或在读取行初始化文件中使用的，绑定到宏的读取行键序列和字符串。
-S | 显示输出绑定到宏的读取行键序列和字符串。
-f filename | 从filename中读取绑定键。
-q function | 查询哪个键调用了这个函数。
-u function | 解除这个函数的所有绑定的键。
-r keyseq | 移除keyseq的任何当前绑定。
-x keyseq:shell-command | 在任何时候输入keyseq都会执行shell-command。当shell-command执行时，shell会将行的行缓冲内容设置到变量READLINE_LINE中。并且变量READLIN_POINT和READLINE_MARK会分别设置为插入点的当前位置和保存的插入点（标记位）。如果执行的命令改变了READLINE_LINE、READLINE_POINT或READLINE_MARK的任何一个值，则新值会反应到编辑状态中。
-X | 以可以作为重新输入的格式列出所有绑定到shell命令的键序列和这些关联的命令。

返回状态是零，除非提供了一个无效的选项或出现了一个错误。

### builtin

```
builtin [shell-builtin [args]]
```

运行一个shell内建命令，并将参数args传入，最后返回该命令的退出状态。在定义函数时，其函数名与内建命令重名时，并且该内建命令在函数体中被调用时，builtin命令用于调用这个内建命令。如果builtin命令调用的shell-builtin不是一个内建命令时，会返回非零状态。

### caller

```
caller [expr]
```

返回任意活动的子程序调用（一个shell函数或一个使用“.”或source内建命令执行的脚本）的上下文。

不加参数expr时，caller显示当前子程序调用的行号和源文件名。如果提供的expr是一个非负整数，则caller显示的是当前执行调用堆栈中相对位置的行号、子程序名称和源文件。这个额外的信息是有用的，例如打印堆栈追踪。当前frame是frame 0。

返回状态值为零，除非shell没有执行一个子程序调用或expr没有对应到调用堆栈中的一个有效位置。

### command

```
command [-pVv] command [arguments ...]
```

运行带有arguments参数的命令，忽略任何和参数command相同名称的函数。只执行shell内建命令或在PATH变量中搜索到的命令。如果有一个shell函数，其名称是ls，在函数中运行“command ls”就会执行外部命令ls，而不是递归调用该函数。“-p”选项的含义是使用变量PATH为默认值，用于确保可找到所有的标准命令工具。如果找不到要运行的命令或出现了一个错误，则返回状态值为127。还有返回命令的其它退出状态。

如果提供了“-V”或“-v”选项，则打印命令的描述。“-v”选项使用单一单词来显示说明调用command的命令名或文件名；“-V”选项则产生更多的说明。在这种情况下，如果找到命令则返回状态零，否则返回非零。

### declare

```
declare [-aAfFgiIlnrtux] [-p] [name[=value] ...]
```

声明变量并给其设置属性。如果没有给出变量名，则显示变量值。

“-p”选项用于显示每个name所代表的变量的值和属性。当使用“-p”选项时，同时还带有name参数，其它附加选项除了“-f”和“-F”之外，都会被忽略。

当出现“-p”选项并且未给出name参数时，declare将会显示带有由其它附加选项指定的属性的所有变量的属性和变量值。如果在使用“-p”时没有其它选项出现，则declare显示所有变量的属性和值。“-f”选项用于显示shell函数。

“-F”选项不会显示函数定义，仅显示函数名和属性。如果使用shopt开启了shell选项“extdebug”，将显示每个定义的name所在的源文件名和所在行数。

即使当declare执行于shell函数内部，“-g”选项强制在全局作用域创建或修改变量。但在其它情况下，该选项会被忽略。

“-I”选项会使本地变量继承自附近作用或中具有相同name名的现有变量的属性（nameref属性除外）和值。如果没有现有变量存在，本地变量在初始化时就会被释放。

下列选项常用于对变量指定的属性进行限制输出或给出变量属性：

选项 | 说明
--- | ---
-a | 每一个name为一个索引数组变量。
-A | 每一个name为一个关联数组变量。
-f | 只使用函数名。
-i | 视变量为一个整数类型；当变量赋与一个值时进行算术运算。
-l | 当变量进行赋值时，所有大写字母都改写为小写字母。禁用大写属性。
-n | 给予每一个name变量nameref属性，使其名称引用到另外一个变量上。定义name的值为那个其它变量。对于name的所有引用、赋值和属性修改，除了使用或改变“-n”属性其本身外，都将应用于name值所引用到的变量身上。nameref属性不能应用到数组变量上。
-r | 设置name变量为只读。这些name变量在后继赋值语句中不能进行赋值操作或进行释放操作。
-t | 对每一个name变量设置trace属性。追踪函数从调用方shell继承DEBUG和RETURN捕获器。trace属性对于变量来说没有特殊意义。
-u | 当变量赋值时，将所有小写字母都改写为大写字母。禁用小写属性。
-x | 通过环境将每一个name导出给后继命令。

使用加号“+”替换选项前面的减号“-”来关闭属性。但例外是“+a”和“+A”不能用于摧毁数组变量，“+r”不能用于移除只读属性。在函数中使用declare时，其会将每个name变量本地化，就像使用了local命令一样，但使用“-g”选项除外。如果一个变量name后跟随着“=value”，则该变量的值将设置为value。

当在复合赋值语法中使用“-a”或“-A”来创建数组变量时，直到随后赋值发生时附加属性才会生效。

返回状态为零，除非下列情况发生：

- 试图使用“-f foo=bar”形式定义一个函数。
- 试图对只读变量进行赋值。
- 试图在不使用复合赋值语法情况下对数组变量进行赋值。
- 变量名name不是一个有效的shell变量名。
- 试图关闭只读变量的只读属性。
- 试图关闭数组变量的数组属性。
- 试图使用“-f”选项显示一个不存在的函数。

### echo

```
echo [-neE] [arg ...]
```

使用空格作为分隔符和使用换行作为终止符，输出参数arg。返回状态为零，除非出现一个写错误。如果指定了“-n”，则抑制尾部的换行。如果给出“-e”选项，则开启反斜线转义字符解释器。“-E”选项则是关闭反斜线转义字符解释器，即使系统默认对其转义。shell选项“xpg_echo”默认可以用来动态确定echo是否对转义字符进行转义扩展。echo不会将“--”解释为选项结果。

下列是echo解释转义列表：

转义符 | 含义
--- | ---
\a | 报警（铃声）
\b | 向前删除
\c | 抑制进一步的输出
\e<br>\E | 取消
\f | 换页
\n | 换行
\r | 回车
\t | 水平制表符
\v | 垂直制表符
\\ | 反斜线
\0nnn | 八进制值nnn（0到3位）表示一个8位字符
\xHH | 十六进制值HH（1到2位）表示一个8位字符
\uHHHH | 十六进制值HHHH（1到4位）表示一个Unicode(ISO/IEC 10646)字符
\UHHHHHHHH | 十六进制值HHHHHHHH（1到8位）表示一个Unicode(ISO/IEC 10646)字符

### enable

```
enable [-a] [-dnps] [-f filename] [name ...]
```

用于开启或禁用shell内建命令。禁用一个内建命令可以使一个与该内建命令同名的外部命令直接执行，而不用指定完整路径，即使shell通常情况下在搜索外部命令前先对内建命令进行搜索。如果使用了“-n”选项，则禁用name参数所代表的内建命令。否则，则是开启该内建命令。例如，要直接使用一个在$PATH中叫test的外部命令而不是shell的内建命令test时，先键入“enable -n test”来禁用内建命令。

如果“-p”选项出现，或没有给出name参数，则打印shell内建命令列表。不带有其它参数时，列表所包含的是所有开启的shell内建命令。“-a”选项意味着列出的内建命令列表具有指示该命令是处于开启还是关闭状态。

在支持动态加载的系统中，“-f”选项意味着从共享对象filename中加载新内建命令。“-d”选项会删除使用“-f”选项加载进来的内建命令。

如果没有选项出现，则显示一个shell内建命令列表。“-s”选项只显示POSIX特定的内建命令。如果在使用“-s”的同时加入“-f”，则新加载的内建命令就变为特定内建命令。

返回状态为零，除非name不是一个shell内建命令或从共享对象中加载新内建命令时出错。

### help

```
help [-dms] [pattern]
```

显示关于内建命令的帮助信息。如果指定了pattern，help则给出所有匹配pattern的命令的详细帮助。否则将打印内建命令列表。

如果出现选项，则具有以下含义：

选项 | 含义
--- | ---
-d | 显示每一个pattern的短描述。
-m | 使用类似man page格式显示每一个pattern的描述。
-s | 只显示每一个pattern的简短概要语法。

返回状态为零，除非pattern没有匹配到任何命令。

### let

```
let expression [expression ...]
```

内建命令let允许在shell变量上执行算术运算。每一个表达式“expression”可以依据下面6.5节《Shell算术运算》中的规则进行表达式运算。如果最后一个表达式运算结果为0，则let返回1；否则返回0。

### local

```
local [option] name[=value] ...
```

对于命令中的每一个参数，会创建以name命名的本地变量，并将value赋值给它。declare命令的所有选项是该命令可接受的选项。local只能用于函数内部；它将变量name的作用域设置为在该函数和其子函数中可见。如果name是“-”，则shell选项集的作用域被置为调用local的函数的内部：在函数内部可使用set内建命令对shell选项进行变更，并在函数返回时还原这些选项。还原操作所产生的作用就像使用set命令将选项值设置为函数调用之前的状态一样。返回状态为零，除非在函数外部使用了local命令，或提供了一个无效的name，或name是一个只读变量。

### logout

```
logout [n]
```

退出已登录的shell，向shell的父进程返回状态n。

### mapfile

```
mapfile [-d delim] [-n count] [-O origin] [-s count] [-t] [-u fd] [-C callback] [-c quantum] [array]
```

从标准输入读取行并存入索引数组变量array中。如果提供了“-u”选项，则从文件描述符fd中读取。变量MAPFILE是默认的数组。如果提供了选项，则具有下列含义：

选项 | 含义
--- | ---
-d | 使用delim的第一个字符代替换行来表示每一输入行的结束。如果delim是空字符串，mapfile在读到字符NUL时才结束行读取。
-n | 复制count行。如果count是0，则复制所有行。
-O | 从数组array的索引位置orgin开始进行赋值。默认索引位置为0。
-s | 丢弃前count行的读取。
-t | 从每一行读取中移除尾部的分隔符（默认是换行）。
-u | 从文件描述符fd中读取行，而不是从标准输入读取。
-C | 在每一次读取quantum行时执行callback。使用“-c”选项指定quantum。
-c | 指定读取行数用于在每一次调用callback时使用。

如果在指定了“-C”时未指定“-c”，则默认的quantum为5000。当执行callback时，其提供要分配的下一个数组元素的索引位置，并且将分配给那个元素的行作为附加参数。在行读取后，将其分配给数组元素之前运行callback。

如果没有明确给出origin，mapfile会在数组赋值前将其清空。

mapfile返回成功状态，除非提供了一个无效的选项或选项参数，或数组是无效的或不可被赋值的，或数组不是索引数组。

### printf

```
printf [-v var] format [arguments]
```

按照format的格式将格式化后的arguments写入到标准输出。“-v”选项会将要打印到标准输出的结果分配到变量var中。

format的格式是包含了三种对象类型的字符串：明文字符，可直接复制到标准输出；字符转义序列，转换后复制到标准输出；格式规范，每次会打印arguments中下一个后继参数。
除了printf(1)中的标准格式，printf会将下列扩展进行翻译转换：

扩展 | 说明
--- | ---
%b | 会使printf将相应argument里的反斜线转义序列使用与“echo -e”相同的方式对其进行转义扩展。
%q | 会使printf使用format设定的格式将argument输出并可重用于shell输入。
%(datefmt)T | 会使printf使用strftime(3)的格式格式化datefmt为日期时间字符串并输出。相应的参数argument是一个代表从新纪元开始的秒数的整数。可用到两个特殊参数值：“-1”代表当前时间，“-2”代表调用shell时的时间。如果没有指定参数，则转换行为就像给出了“-1”一样。这是printf正常行为的一个例外。

“%b”、“%q”和“%T”可以在格式规范中指定字段的宽度和精度，并且扩展后的参数需要比原始值使用更多字节（或更宽的字段）来表示这一字段，通常所包含的字符要多于原始字符。

对于标识为非字符串格式的arugments参数，都被视为C语言常量。除了允许在值前面出现加号或减号，如果在字符前面是单引号或双引号，则其值为字符的ASCII值。format参数按需求对所有arguments参数进行格式化。如果fromat需要的参数个数比arguments提供的个数要多的话，格式化规范行为所需的额外参数则由适当的0值或空字符串提供。命令成功的返回值是零，失败为非零值。

### read

```
read [-ers] [-a aname] [-d delim] [-i text] [-n nchars] [-N nchars] [-p prompt] [-t timeout] [-u fd] [name ...]
```

从标准输入或从“-u”选项提供的参数fd代表的文件描述符中读取一行。之后使用在3.5.7《单词分割》中描述的规则将输入分割为单词，并且将第一个单词分配给第一个name参数，将第二个单词分配给第二个name参数，以此例推。如果读入的单词多于name参数，则多余的单词和其之间的分隔符都分配给最后一个name参数。如果单词个数少于name参数个数，则剩余name参数将被分配为空（empty）值。使用与shell扩展中IFS变量进行单词分割的规则一样的规则将读入行进行单词分割。可以使用反斜线“\”移除其后面一个字符的特殊含义和用于行的继续读取。
如果出现下列选项，则具有以下含义：

选项 | 含义
--- | ---
-a aname | 分割出的单词分配给索引数组变量aname，起始下标为0。在分配之前会将aname中的所有元素删除。忽略其它name参数。
-d delim | delim的第一个字符用于替换换行作为输入行的终结符。如果delim是一个空字符串，read将读取到NUL字符时才会终结一行。
-e | Readline（参见第8章《命令行编辑》）用于获取行。Readline使用当前编辑设置（或使用默认设置，如果之前没有激活过行编辑），但使用Readline的默认文件名补全机制。
-i text | 如果Readline正用于读取行，在编辑开始之前由text代替编辑缓冲。
-n nchars | read在读取nchars个字符后直接返回退出，而不是等到一整行读取完成。但如果在分隔符出现之前的字符个数小于nchars，则分隔符继续生效。
-N nchars | 除非遇到EOF或read运行超时，其会在精确读取nchars个字符后返回退出，而不会等待整行输入完成。在输入行中出现的分隔符不会被特殊对待，并且直到读取了nchars个字符后read才会返回退出。读取的结果不会依据变量IFS中的字符进行单词分割，其目的在于将读取的字符精确地分配给变量。
-p prompt | 在读取输入之前，显示一个末尾不带有换行的输入提示。只有在输入是来处于终端时才会显示这个提示。
-r | 如果给出了这个选项，反斜线将不会作为转义字符使用。反斜线会作为这一行的一部分进行读取。通常，一个反斜线加换行也不会作为行继续读取符。
-s | 静默模式。如果行输入来处于终端，读取的字符不会在终端上回显出来。
-t timeout | 如果在timeout指定的秒数里没有完成读取（或没有读取到指定的字符个数），则read读取超时并且返回失败状态。timeout可以设置为一个带有小数点的小数。这个选项只在输入是从终端、管道或其它特殊文件中读取时生效；当其从一个常规文件中读取时则不会产生作用。如果读取超时，read会将已输入的部分字符存入指定的变量name中去。如果timeout设置为0，read不会试图读取任何数据而立即返回退出。如果在指定的文件描述符上的输入是可用的，则即出状态为零。否则返回非零值。如果timeout超时，则返回一个大于128的退出状态。
-u fd | 从文件描述符fd中读取输入。

如果没有给出name参数，不包含尾部分隔符的未做任何更改的读取行将分配给变量REPLY。正常退出状态为零，除非遭遇end-of-file，或read超时（在这种情况下返回值大于128），或变量赋值出错（例如对读取变量进行赋值），或在“-u”选项使用时给出了一个无效的文件描述符。

### readarray

```
readarray [-d delim] [-n count] [-O origin] [-s count] [-t] [-u fd] [-C callback] [-c quantum] [array]
```

从标准输入读取行，或如果使用了“-u”选项则从文件描述符读取，之后存入索引数组变量array中。与mapfile命令相同。

### source

```
source filename
```

与Bourne Shell内建命令“.”相同。

### type

```
type [-afptP] [name ...]
```

对于每一个给出的name参数，如果将其视为一个命令名，则对其进行解释说明。

如果使用了“-t”选项，type则打印“alias”、“function”、“builtin”、“file”或“keyword”其中的一个单词来表示该命令是一个别名、shell函数、shell内建命令、磁盘文件或是一个保留字。如果找不到name，则不会打印任何信息，并且返回失败状态。

如果使用了“-p”选项，type会返回name代表的可执行的磁盘文件名，或如果name在使用“-t”时返回的不是一个“file”类型，则什么都不返回。

“-P”选项对每一个name参数在PATH路径中进行强制搜索，即使该name所代表的不是一个文件类型。

如果一个命令已经被缓冲到哈希表中，“-p”和“-P”则打印这个哈希值，这并不需要该文件首先出现在$PATH中。

如果“-a”选项出现，type会将所有该name代表的可执行文件名返回。当且仅当同时没有“-p”选项出现，也会列出别名和函数。

如果“-f”选项出现，type不会试图去寻找shell函数。

如果所有name参数都找到，则返回状态为零。如果有一个没有找到，则返回非零。

### typeset

```
typeset [-afFgrxilnrtux] [-p] [name[=value] ...]
```

typeset命令是用于兼容Korn shell。它与内建命令declare用法类似。

### ulimit

```
ulimit [-HS] -a
ulimit [-HS] [-bcdefiklmnpqrstuvxPRT] [limit]
```

如果系统允许的话，ulimit可通过可用资源提供对shell启动的进程进行控制。如果给出下列选项，则具有下列含义：

选项 | 含义
--- | ---
-S | 变更并报告关联到资源的软限制。
-H | 变更并执行关联到资源的硬限制。
-a | 报告所有当前限制；不进行限制设置。
-b | 最大套接字缓冲大小。
-c | 创建的核心文件最大大小。
-d | 一个进程的数据段最大大小。
-e | 最大计划优先级（"nice"）。
-f | shell及其子shell的文件写入最大大小。
-i | 挂起信号的最大数量。
-k | 可分配的kqueues的最大数量。
-l | 在内存中可被锁定的最大大小。
-m | 最大驻留集大小（大多数系统不遵守这一限制）。
-n | 打开文件描述符的最大个数（大多数系统不允许设置这个值）。
-p | 管道缓冲大小。
-q | POSIX消息队列的最大字节数量。
-r | 最大实时计划优先级。
-s | 最大堆栈大小。
-t | 最大CPU时间占用秒数。
-u | 对于一个单用户的最大可用进程数量。
-v | shell的最大可用虚拟内存数量，有些系统中还包含其子shell的。
-x | 最大文件锁数量。
-P | 最大伪终端的数量。
-R | 在被阻止前实时进程可运行的最大时长，单位毫秒。
-T | 最大线程数。

如果给出limit参数，并且没有给出“-a”选项，则limit则是设置的指定资源的新值。limit的特殊值“hard”、“soft”和“unlimited”分别代表当前的硬限制、当前的软限制和没有限制。一旦设置了一个硬限制，其不能被非根用户进行增量设置；可以使用软限制对硬限制的值进行增量增加。否则，除非提供“-H”选项，则只打印所指定资源的软限制当前值。当指定了多于一个的资源，如果所提供的限制名称和单位正确，则打印在其值之前。当在设置新限制时，如果“-H”和“-S”选项都出现了，则对硬、软两种限制进行设置。如果没有选项给出，则假定为使用了“-f”选项。所有值的是以1024字节为一个增量单位，除了“-t”是使用的秒为单位；“-R”是使用毫秒；“-p”是使用512字节块为单位；“-P”、“-T”、“-b”、“-k”、“-n”和“-u”则是没有设定增量单位；并且，当在POSIX模式中，“-c”和“-f”则是使用512字节作为增量单位。

正常返回状态为零，除非给出了一个无效选项或参数，或当设置新限制时出现了一个错误。

### unalias

```
unalias [-a] [name ... ]
```

从别外列表中删除给出的name参数所代表的别名。如果“-a”选项出现，则删除所有别名。在6.6《别名》一节有对别名的详细说明。